title Creating A Minion
bottomparticipants 
actor add_minion.sh
participant wireguard
boundary wg_interface
control Master_API 1
entity Master
control Master_API 2

[->add_minion.sh:
activate add_minion.sh
add_minion.sh->wireguard: Create Priv&Pub Keys
add_minion.sh<--wireguard:
add_minion.sh->Master_API 1: "Add me as your peer"\n <pub key>
activate Master_API 1
Master_API 1->Master: Add peer to wg Conf\nCheck num Peers
Master_API 1<--Master: okay; <int> peers
Master_API 1->wireguard: Reload Service
wireguard-->Master_API 1:
add_minion.sh<--Master_API 1: "Here's your wg ip" <wg ip>
deactivate Master_API 1
add_minion.sh->wireguard: Create wg Conf and Interface\n Start wireguard as a daemon
wireguard->>*wg_interface:
note over wg_interface: PersistentKeepAlive
activate wg_interface
add_minion.sh<--wireguard:
add_minion.sh->wg_interface: Forward: "Add me as a minion" <ssh private key>
wg_interface->Master_API 2: "Add me as a minion" <ssh private key>
activate Master_API 2
Master_API 2->Salt-cloud: *Gru Mode*
Master_API 2<--Salt-cloud: say lesss
wg_interface<--Master_API 2: Forward: 200 Okay
wg_interface-->add_minion.sh: 200 Okay
deactivate Master_API 2